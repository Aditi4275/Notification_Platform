<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Alertify</title>
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'&gt;&lt;path d='M8 0C5.24 0 3 2.24 3 5v2.5c0 .7-.3 1.35-.8 1.85L.8 10.75c-.4.4-.4 1 0 1.4l1.4 1.4c.4.4 1 .4 1.4 0l1.4-1.4c.5-.5 1.15-.8 1.85-.8H11c.7 0 1.35.3 1.85.8l1.4 1.4c.4.4 1 .4 1.4 0l1.4-1.4c.4-.4.4-1 0-1.4l-1.4-1.4c-.5-.5-.8-1.15-.8-1.85V5C15 2.24 12.76 0 10 0H8zm0 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z' fill='%23FFD700'/&gt;&lt;/svg&gt;">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="overflow-y-auto" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
  <div class="main-container" style="max-width: 100%; padding: 0; padding-top: 1rem; overflow-y: auto;">
    <!-- Header Section -->
    <div class="header-section" style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; width: 100%;">
      <div style="display: flex; align-items: center;">
        <div class="logo-container" style="width: 60px; height: 60px; margin: 0 1rem 0 0;">
          <span class="logo-icon" style="font-size: 1.5rem;">üîî</span>
        </div>
        <div>
          <h1 class="title" style="font-size: 1.5rem; margin: 0; text-align: left;">Admin Dashboard</h1>
          <p class="subtitle" style="font-size: 0.75rem; margin: 0.25rem 0 0 0; text-align: left;">Alertify</p>
        </div>
      </div>
      <div>
        <button id="logoutBtn" class="btn admin-btn" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
          Logout
        </button>
      </div>
    </div>

    <!-- Main Content Area -->
    <div style="display: flex; flex-direction: column; width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 1rem; overflow-y: auto;">
      <!-- Stats Cards Row -->
      <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
        <div class="card" style="flex: 1; min-width: 200px; padding: 1rem; text-align: center; background: linear-gradient(to right, #dbeafe, #bfdbfe);">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîî</div>
          <p style="color: #4b5563; font-size: 0.8rem; margin-bottom: 0.25rem;">Total Alerts</p>
          <p class="text-2xl font-bold" id="totalAlerts" style="font-size: 1.75rem;">0</p>
        </div>
        <div class="card" style="flex: 1; min-width: 200px; padding: 1rem; text-align: center; background: linear-gradient(to right, #fef9c3, #feecb0);">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚úÖ</div>
          <p style="color: #4b5563; font-size: 0.8rem; margin-bottom: 0.25rem;">Delivered</p>
          <p class="text-2xl font-bold" id="alertsDelivered" style="font-size: 1.75rem;">0</p>
        </div>
        <div class="card" style="flex: 1; min-width: 200px; padding: 1rem; text-align: center; background: linear-gradient(to right, #bbf7d0, #86efac);">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìñ</div>
          <p style="color: #4b5563; font-size: 0.8rem; margin-bottom: 0.25rem;">Read</p>
          <p class="text-2xl font-bold" id="alertsRead" style="font-size: 1.75rem;">0</p>
        </div>
        <div class="card" style="flex: 1; min-width: 200px; padding: 1rem; text-align: center; background: linear-gradient(to right, #ddd6fe, #c4b5fd);">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚è∏Ô∏è</div>
          <p style="color: #4b5563; font-size: 0.8rem; margin-bottom: 0.25rem;">Snoozed</p>
          <p class="text-2xl font-bold" id="alertsSnoozed" style="font-size: 1.75rem;">0</p>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem; width: 100%;">
        <!-- Left Panel - Create Alert -->
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
          <!-- Create Alert Card -->
          <div class="card" style="padding: 1.5rem;">
            <h2 class="card-title" style="font-size: 1.25rem; text-align: center; margin-bottom: 1rem;">Create New Alert</h2>
            <form id="createAlertForm" class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Title *</label>
                <input type="text" name="title" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                  placeholder="Alert title">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Message *</label>
                <textarea name="message" required rows="3" 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                  placeholder="Alert message"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Severity *</label>
                <select name="severity" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                  <option value="">Select Severity</option>
                  <option value="INFO">Info</option>
                  <option value="WARNING">Warning</option>
                  <option value="CRITICAL">Critical</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Delivery Type *</label>
                <select name="delivery_type" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                  <option value="INAPP">In-App (MVP)</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Visibility *</label>
                <select name="visibility" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                  <option value="ORG">Organization</option>
                  <option value="TEAM">Team</option>
                  <option value="USER">User</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Start Time *</label>
                <input type="datetime-local" name="start_time" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Expiry Time *</label>
                <input type="datetime-local" name="expiry_time" required 
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1 text-center">Reminder Frequency (hours)</label>
                <input type="number" name="reminder_frequency" min="1" value="2"
                  class="w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                  placeholder="Frequency in hours">
              </div>
              
              <div class="flex items-center">
                <label class="flex items-center">
                  <input type="checkbox" name="reminder_enabled" checked
                    class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                  <span class="ml-2 text-sm text-gray-600">Enable Reminders</span>
                </label>
              </div>
              
              <button type="submit" class="btn admin-btn" style="width: 100%; margin-top: 1rem;">
                Create Alert
              </button>
              <div id="creationStatus" class="text-green-600 text-sm text-center mt-1"></div>
            </form>
          </div>

          <!-- Quick Stats Card -->
          <div class="card" style="padding: 1.5rem;">
            <h3 style="font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem; text-align: center;">Quick Stats</h3>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <div style="display: flex; justify-content: space-between;">
                <span style="color: #6b7280; font-size: 0.8rem;">Total Alerts:</span>
                <span id="totalAlerts" style="font-weight: 500; font-size: 0.8rem;">0</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: #6b7280; font-size: 0.8rem;">Active Alerts:</span>
                <span id="activeAlerts" style="font-weight: 500; font-size: 0.8rem;">0</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: #6b7280; font-size: 0.8rem;">Critical Alerts:</span>
                <span id="criticalAlerts" style="font-weight: 500; font-size: 0.8rem;">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Panel - Manage Alerts -->
        <div class="card" style="padding: 1.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 class="card-title" style="font-size: 1.25rem; text-align: center; margin: 0;">Manage Alerts</h2>
          </div>
          
          <!-- Filters -->
          <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1rem;">
            <select id="filterSeverity" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem;">
              <option value="">Filter by Severity</option>
              <option value="INFO">Info</option>
              <option value="WARNING">Warning</option>
              <option value="CRITICAL">Critical</option>
            </select>
            <select id="filterStatus" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem;">
              <option value="">Filter by Status</option>
              <option value="active">Active</option>
              <option value="expired">Expired</option>
            </select>
            <select id="filterAudience" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem;">
              <option value="">Filter by Audience</option>
              <option value="ORG">Organization</option>
              <option value="TEAM">Team</option>
              <option value="USER">User</option>
            </select>
            <button id="applyFilters" style="background-color: #10b981; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; font-size: 0.875rem; cursor: pointer;">
              Apply Filters
            </button>
          </div>
          
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
              <thead>
                <tr style="background-color: #f3f4f6;">
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Title</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Severity</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Audience</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Start Time</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Expiry Time</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Status</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Reminders</th>
                  <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Actions</th>
                </tr>
              </thead>
              <tbody id="alertsTableBody">
                <!-- Alerts will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Teams & Members Section -->
      <div class="card" style="padding: 1.5rem; margin-top: 1.5rem;">
        <h2 class="card-title" style="font-size: 1.25rem; text-align: center; margin-bottom: 1rem;">Teams & Members</h2>
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
            <thead>
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Team</th>
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: #6b7280; border-bottom: 2px solid #e5e7eb;">Members</th>
              </tr>
            </thead>
            <tbody id="teamsTableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="footer" style="margin-top: 2rem; padding: 0 2rem;">
      <p>¬© 2025 Alert Management System. All rights reserved.</p>
    </div>
  </div>

  <script src="js/auth_utils.js"></script>
  <script src="js/admin_dashboard.js"></script>
  
  <script>
    document.getElementById('refreshAlerts')?.addEventListener('click', function() {
      loadAlerts();
    });
  </script>
</body>
</html>
